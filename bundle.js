(()=>{"use strict";const e=["notStarted","inProgress","completed"],t={notStarted:"Not Started",inProgress:"In progress",completed:"Completed"};function a(a){let o,d;Object.keys(a).forEach((s=>{o=document.querySelector(`[data-area="${s}"]`),d=o.lastElementChild,o.innerHTML="",a[s].forEach((a=>{o.appendChild(function({id:a,content:o,status:d}){let s=document.createElement("li");s.setAttribute("id",a),s.setAttribute("data-status",d),s.setAttribute("draggable",!0),s.classList.add("element");let n=e.filter((e=>e!==d)).map((e=>`\n    <li class="miniMenu__item moveCard" data-button="${e}" data-action="moveCard" data-id="${a}" data-belongsTo="${d}">\n        <i class="fa fa-arrow-right"></i>\n        ${t[e]}\n    </li>`));return s.innerHTML=`\n    <div>\n    <i class="dots"></i>\n\n        <label class="checkbox element__label">\n        <input type='checkbox' data-action="check" data-id="${a}" data-status="${d}"/>\n            <span class="elementContent">${o}</span>\n            <ul class="miniMenu">\n                <li class="miniMenu__item editCard" data-action="editCard" data-belongsTo="${d}" data-id="${a}"><i class="fa fa-edit"></i>Editar</li>\n                <li class="miniMenu__item removeCard" data-action="removeCard" data-id="${a}" data-belongsTo="${d}"><i class="fa fa-trash"></i>Excluir</li>\n                ${n.join("")}\n            </ul>\n        </label>\n\n        </div>\n            `,s}(a))})),o.appendChild(d)}))}function o(e){!function(e){localStorage.setItem("todos",JSON.stringify(e))}(e),a(e)}const d={todoList:JSON.parse(localStorage.getItem("todos"))||{notStarted:[],inProgress:[],completed:[]},addNew(e){this.todoList[e.status].push(e),o(this.todoList)},remove(e,t){this.todoList[t]=this.todoList[t].filter((t=>t.id!==e)),o(this.todoList)},updateContent(e,t,a){this.todoList[t]=this.todoList[t].map((t=>t.id===e?{...t,content:a}:t)),o(this.todoList)},updatePosition(e,t,a,d){let s=this.todoList[t].findIndex((t=>t.id===e)),n=this.todoList[t].splice(s,1);n={...n[0],status:a};let r=this.todoList[a].findIndex((e=>e.id===d));-1===r?this.todoList[a].push(n):this.todoList[a].splice(r,0,n),o(this.todoList)}};function s(e){return e.match(/^\s*$/)}let n,r,i,c,l;function u(e,t,a,o=""){d.updatePosition(e,t,a,o)}a(d.todoList);let m=document.querySelector(".deleteChecked");function h(){document.querySelectorAll(".disabled").forEach((e=>{e.classList.remove("disabled")}))}document.querySelectorAll(".checkAll").forEach((e=>{e.onclick=t=>{document.querySelectorAll(`[data-area="${e.dataset.input}"] input[type="checkbox"]`).forEach((e=>{e.checked=t.target.checked})),m.disabled=!t.target.checked}})),m.onclick=e=>{document.querySelectorAll('ul [type="checkbox"]:checked').forEach((e=>{d.remove(e.dataset.id,e.dataset.status)}))},document.querySelector("#enableCheckbox input").onclick=e=>{m.disabled=!0,document.querySelectorAll(".container").forEach((e=>{e.classList.toggle("checkbox--mode"),e.querySelectorAll("[type='checkbox']:checked").forEach((e=>{e.checked=!1}))}))};const g={removeCard:e=>function(e){d.remove(e.target.dataset.id,e.target.dataset.belongsto)}(e),editCard:e=>function(e){n=e.target.dataset.id,r=e.target.dataset.belongsto,c=document.querySelector(`[data-area="${r}"] .newCardLabel`),i=document.querySelector(`[data-area="${r}"] .editCardLabel`),c.classList.add("cardLabel--invisible"),i.classList.remove("cardLabel--invisible"),l=i.querySelector("textarea"),l.value=d.todoList[r].filter((e=>e.id===n)).map((e=>e.content)),l.focus(),l.onkeydown=e=>{"Enter"===e.key&&(e.preventDefault(),l.blur())},l.addEventListener("focusout",(()=>{s(l.value)||d.updateContent(n,r,l.value),l.value="",i.classList.add("cardLabel--invisible"),c.classList.remove("cardLabel--invisible")}))}(e),moveCard:e=>u(e.target.dataset.id,e.target.dataset.belongsto,e.target.dataset.button),check:e=>{document.querySelector(".deleteChecked").disabled=!document.querySelector("main [type='checkbox']:checked")||!document.querySelector(".checkbox--mode")}};document.querySelectorAll(".newCardLabel > textarea").forEach((e=>{e.onkeydown=t=>{"Enter"===t.key&&(t.preventDefault(),e.blur(),e.focus())},e.onfocus=()=>{e.classList.add("activedTextarea")},e.addEventListener("focusout",(t=>{!function(e){let t=e.value;if(s(t))return;let a={id:Date.now().toString(),status:e.dataset.status,content:t};d.addNew(a)}(e),e.value="",e.classList.remove("activedTextarea")}))})),document.onclick=e=>{let t=document.querySelector(".dotsOpened");t?.classList.remove("dotsOpened"),e.target!==t&&e.target.classList.contains("dots")&&e.target.classList.add("dotsOpened")},document.querySelectorAll(".dropArea").forEach((e=>{e.onclick=e=>{e.target.dataset.action in g&&g[e.target.dataset.action](e)},e.ondragstart=e=>function(e){if(document.querySelector(".checkbox--mode"))return!1;document.querySelector(".dotsOpened")?.classList.remove("dotsOpened"),e.dataTransfer.setData("text",e.target.id),e.dataTransfer.setData("comingFrom",e.target.dataset.status),document.querySelectorAll(".dropArea > li >*").forEach((e=>{e.classList.add("disabled")})),setTimeout((()=>{e.target.classList.add("invisible")}),0)}(e),e.ondrop=t=>function(e,t){let a=e.dataTransfer.getData("text"),o=e.dataTransfer.getData("comingFrom");e.target.querySelector("span").remove(),u(a,o,t.dataset.area,e.target.id),h()}(t,e),e.ondragend=e=>{return t=e,setTimeout((()=>{t.target.classList.remove("invisible")}),0),void h();var t},e.ondragover=e=>e.preventDefault(),e.ondragleave=e=>e.target.querySelector("span").remove(),e.ondragenter=e=>function(e){let t=document.createElement("span");t.classList.add("shadow"),e.target.insertAdjacentElement("afterBegin",t)}(e)}))})();